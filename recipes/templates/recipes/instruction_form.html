{% extends "base_generic.html" %}

{% block content %}
<h1>COOKERY BOOKERY</h1> 
<br>

<h2>Submit a Recipe</h2>

  <p><b>Name:</b> {{ recipe.name }}</p>
  <p><b>Servings:</b> {{ recipe.servings }}</p>
  {% if recipe.nota_bene %}
    <p><b>N.B.</b> {{ recipe.nota_bene }}</p>
  {% endif %}
  <p><em>Need to change something?</em></p>
  {% if update %}
    <p><em>You need to finish editing this instruction before you can edit your recipe!</em></p>
  {% else %}
    <p><a href="{% url 'update-recipe' recipe.id %}?next={{ request.path|urlencode }}"> Edit Recipe</a></p>
  {% endif %}
  
  <h3>Ingredients</h3>
  
  <ul>
    {% for ingredient in recipe.ingredient_set.all %}
        <li>{{ ingredient }}
          {% if not update %} - 
            <a href="{% url 'update-ingredient' ingredient.id %}?next={{ request.path|urlencode }}">Edit</a> -
            <a href="{% url 'delete-ingredient' ingredient.id %}?next={{ request.path|urlencode }}" class="text-danger"> Delete </a>
          {% endif %}
        </li>
    {% endfor %}
    <br>
    {% if not update %} 
      <p><em>Forgot to add an ingredient?</em></p>
      <p><a href="{% url 'add-ingredient' recipe.id %}">Add Ingredient</a></p>
    {% else %}
      <p><em>Need to add, edit or delete an ingredient?</em></p>
      <p><em>You need to finish editing this instruction before you can edit your ingredients!</em></p>
    {% endif %}
  </ul>

  <h3>Add Instructions</h3>

  <ul>
    {% for instruction in recipe.instruction_set.all %}
        {% if pk != instruction.id %}
            <p><b>Step {{ instruction.step_number }}</b>
              {% if not update %} - 
                <a href="{% url 'update-instruction' instruction.id %}?next={{ request.path|urlencode }}">Edit</a> - 
                <a href="{% url 'delete-instruction' instruction.id %}?next={{ request.path|urlencode }}" class="text-danger"> Delete </a>
              {% endif %}
            </p>
            <p>{{ instruction.description }}</p>
        {% endif %}
    {% endfor %} 
  </ul>

  <form action="" method="post">
    {% csrf_token %}
    
    {% if update %}
      <h4>Edit Ingredient</h4>
    {% endif %}
    
    <table>
    {{ form.as_table }}
    </table>
    <input type="hidden" name="next" value="{{ request.GET.next }}">
    <input type="submit" value="Add Instruction">
  </form>

  {% if recipe %}
  <br>
    <h4>All done adding instructions?</h4>
    <form action='{% url "recipe-detail" recipe.id %}' method="get"><button type="submit">Submit Recipe</button></form>
  {% endif %}
  <br>
  <br>
  <br>
{% endblock %}

